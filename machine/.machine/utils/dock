#!/usr/bin/env bash
set -Eeuo pipefail

LAPTOP=eDP-1
L=DP-3-1-1     # left 4K
M=DP-3-8       # mid  4K

wait(){ local o=$1 m=$2; while ! xrandr | awk -v o="$o" -v m="$m" '$1==o{inb=1;next} inb&&/ connected/{exit} inb&&$1==m{f=1} END{exit f?0:1}'; do sleep 0.5; done; }

# Ensure native modes are there (scaling operates on the current/native mode)
wait "$L" 3840x2160
wait "$M" 3840x2160

# Scale 4K -> logical 1080p, place them like at work
xrandr --fb 5760x1200 \
  --output "$LAPTOP" --mode 1920x1200 --scale 1x1     --pos 0x0 --primary \
  --output "$M"      --mode 3840x2160 --scale 0.5x0.5 --pos 1920x0 \
  --output "$L"      --mode 3840x2160 --scale 0.5x0.5 --pos 3840x0

# Optional: tighten panning to avoid scrollable desktops
xrandr \
  --output "$M" --panning 1920x1080+1920+0 \
  --output "$L" --panning 1920x1080+3840+0
